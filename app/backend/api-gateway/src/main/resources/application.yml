server:
  port: ${SERVER_PORT}

spring:
  application:
    name: api-gateway

  cloud:
    gateway:
      server:
        webflux:
          globalcors:
            add-to-simple-url-handler-mapping: true
            cors-configurations:
              '[/**]':
                allowed-origin-patterns: ${CORS_ALLOWED_ORIGINS}
                allowed-methods:
                  - GET
                  - POST
                  - PUT
                  - DELETE
                  - PATCH
                  - OPTIONS
                allowed-headers: "*"
                allow-credentials: true
                max-age: 3600

          routes:
            # User Service Swagger Docs
            - id: user-service-docs
              uri: ${USER_SERVICE_URI}
              predicates:
                - Path=/user-service/v3/api-docs
              filters:
                - RewritePath=/user-service/v3/api-docs, /v3/api-docs

            # Planner Service Swagger Docs
            - id: planner-service-docs
              uri: ${PLANNER_SERVICE_URI}
              predicates:
                - Path=/planner-service/v3/api-docs
              filters:
                - RewritePath=/planner-service/v3/api-docs, /v3/api-docs

            # Catalog Service Swagger Docs
            - id: catalog-service-docs
              uri: ${CATALOG_SERVICE_URI}
              predicates:
                - Path=/catalog-service/v3/api-docs
              filters:
                - RewritePath=/catalog-service/v3/api-docs, /v3/api-docs

# Microservice URIs
services:
  user-service:
    uri: ${USER_SERVICE_URI}
  planner-service:
    uri: ${PLANNER_SERVICE_URI}
  catalog-service:
    uri: ${CATALOG_SERVICE_URI}

# JWT config
jwt:
  secret: ${JWT_SECRET}

# Swagger/OpenAPI
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    use-root-path: true
    urls:
      - name: "User Service"
        url: /user-service/v3/api-docs
      - name: "Planner Service"
        url: /planner-service/v3/api-docs
      - name: "Catalog Service"
        url: /catalog-service/v3/api-docs
      - name: "Gateway (Actuator)"
        url: /v3/api-docs
    urls-primary-name: "User Service"
  webjars:
    prefix: ""
  default-consumes-media-type: application/json
  default-produces-media-type: application/json
