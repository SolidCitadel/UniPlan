## 프로젝트 요구사항 명세서: UniPlan

### 1. 프로젝트 개요

- **프로젝트명**: UniPlan: 시나리오 기반 대학생 수강신청 플래너

- **목표**: 수강신청 실패의 불확실성에 대비하여, 사용자가 사전에 정의한 여러 시나리오(Plan B, C...)를 기반으로 실제 수강신청 시 빠르고 체계적인 의사결정을 지원하는 웹 애플리케이션 개발.

- **해결하고자 하는 문제**:

    - **파편화된 계획**: 학생들이 여러 개의 시간표 이미지를 만들며 비상 계획을 세우지만, 각 계획이 유기적으로 연결된 '시나리오'가 아니어서 실제 상황에 적용하기 어려움.

    - **의사결정 병목**: 수강신청 실패라는 돌발 상황의 심리적 압박으로 인해, 여러 대안을 즉석에서 비교하고 최적의 경로를 판단하기 어려워 차선책을 선택하게 됨.


### 2. 주요 기능 요구사항

1. **의사결정 트리 기반의 시나리오 플랜 구축**

    - 사용자는 기본(최선) 시간표를 생성.

    - 시간표 내 각 과목에 대해 '신청 실패 시'를 가정하고, 그에 대한 대체 시간표 시나리오를 직접 구성하여 연결.

    - 대체 시간표 내의 과목이 실패할 경우를 대비한 하위 시나리오도 중첩하여 구성 가능. (즉, 의사결정 트리 구조로 시나리오 관리)

2. **실시간 수강신청 시나리오 네비게이터**

    - 실제 수강신청 환경을 위한 전용 UI 제공.

    - 사용자가 자신의 플랜(의사결정 트리)을 불러온 후, 각 과목의 '성공/실패' 여부를 실시간으로 입력.

    - 입력 결과에 따라, 사전에 구축된 의사결정 트리를 탐색(Navigate)하여 다음에 신청해야 할 최적의 과목과 시간표를 즉시 시각적으로 제시.

3. **다중 필터를 활용한 강의 검색**

    - 시간표 계획 시, 전공/교양, 학점, 강의 시간, 강의실 위치 등 다양한 조건의 필터를 통해 원하는 강의를 쉽게 탐색하는 기능.

4. **커뮤니티 강의평 정보 연동**

    - 검색된 강의 목록이나 시간표에 포함된 강의에 대해 커뮤니티(예: 에브리타임)의 강의평을 쉽게 확인할 수 있도록 정보 연동 혹은 링크

### 3. 사용 시나리오

#### 1) 강의 검색 페이지 (희망과목 담기)
1. 전공/교양 등 분류, 학점수, 강의 시간, 강의실 위치 등 다양한 필터링 및 정렬로 표시됨
2. 우선순위를 정해서 희망하는 강의들을 담음

#### 2) 희망과목 조회 페이지
1. 사용자가 담은 희망 과목들을 우선순위별로 분류해서 보여줌
2. 우선순위 변경, 목록에서 제거 가능

#### 3) 시간표 생성 페이지 (희망과목들로 시간표 생성)
1. 열을 월화수목금, 행을 시간단위로 표시하는 시간표 UI가 가운데에 표시됨
2. 왼쪽 바에는 자기가 담은 희망과목들이 보임. 필터링/정렬도 가능.
    1. 신청 가능 / 불가능 / 제외됨 으로 구분되며, 불가능은 이미 시간대가 겹치는 강의가 있음을, 제외됨은 대안 계획 상 실패를 상정한 강의에 해당됨.
    2. 신청 가능 과목들은 기본적으로 우선순위에 따라 정렬됨
3. 희망강의 중 하나를 누르면, 시간표 UI에 해당 과목의 수업 시간만큼의 박스가 그려짐. 해당 과목을 시간표에 편입했음을 의미.
4. '대안 시간표 계획' 버튼을 누른 뒤, 시간표UI에서 원하는 과목들을 선택 후 '확인'을 누름. 이 과목들이 수강신청에 실패했다는 상정 하에 해당 과목들이 제외된 상태의 복사본 시간표를 생성함

##### 대안 시간표 계획
1. 기본 시간표 계획과 동일한 페이지에서 수정. parent와 excluded가 존재하는것 외에는 동일하게 다룸
2. 기반이 되는 시간표와 동일한 내용은 시간표UI에서 회색, 대안에서 새로 추가한 과목은 UI에서 파란색으로 표현함.
3. 한 시간표에는 여러 대안이 가능하고(실패의 경우의수 마다), 대안 시간표에 대한 대안도 계층적으로 생성 가능
4. 단, 이미 대안이 생성된 시간표를 수정하면 대안에 영향을 끼치므로 기본적으로는 금지하는것으로 함.

#### 4) 시나리오 생성 페이지 (시간표들을 노드로 의사결정트리 구성)
1. 계획했던 시간표들을 목록화함
2. 개별 시간표를 누르면 왼쪽에는 시간표와 대안들의 계층 구조를 의사결정트리로 시각화해서 보여주고, 오른쪽에서는 현재 선택한 시간표에 대해 시간표 UI를 보여줌.

##### 의사결정트리 시각화
1. 캔버스에 기본 시간표의 강의들을 블럭으로 표시함 (세로로 정렬)
2. 그 오른쪽 열에 해당 시간표의 대안 시간표들을 같은 형식으로 표시함. 이 때 기본 시간표에서 출발해서 대안 시간표로 도착하는 빨간색 화살표를 그림. 화살표 위에는 실패를 상정한 과목명들을 작은 텍스트로 표시함.
3. 대안의 대안까지 계획된 만큼 계속 오른쪽으로 이어지도록함.
4. 각 시간표 블록들을 눌러서 시간표UI를 보거나, 다시 '시간표 생성'페이지로 이동해 수정가능함.

#### 5) 수강신청 페이지 (시나리오 자동 추적)
개별 과목의 성공/실패 여부에 따라 시나리오를 자동 추적해 다음 신청 과목을 계산함.

1. 계획한 시나리오(시간표) 목록을 왼쪽 바에 표시함
2. 시나리오를 선택하면, 왼쪽 바는 해당 시간표의 과목들을 목록으로 띄우는 형태로 바뀌게 됨.
3. 우측에는 현재 수강신청 성공/실패 상태에 따라 시간표UI를 그리며 현황을 시각화함.
4. 왼쪽 바에서 과목들은 '신청 전'상태로 그룹화되어 있으며, 각 항목마다 우측에 '체크'와'엑스'버튼이 있음. '체크'는 해당 과목의 수강신청에 성공했다는 의미, '엑스'는 실패했다는 의미.
5. 신청 전 과목은 반투명 회색 상태로 시간표UI에 올라가게 됨.
6. '체크'를 누른 과목은 '신청 성공'상태의 그룹으로 이동함. 우측 시간표 UI에서는 해당 과목의 블럭을 초록색으로 칠함.
7. '엑스'를 누른 과목은 '신청 실패'상태의 그룹으로 이동함. 시간표UI에서는 해당 과목의 블럭을 없앰.

##### 시나리오 자동 전환 (목표 시간표 달성 실패 시)
1. '신청 전'상태의 과목들에 대해 성공/실패를 모두 결정해서 해당 그룹을 다 비운 상태에, 현재 성공한 과목 목록이 목표 시간표와 맞지 않는다면, 사전에 계획한 대안 시간표를 로딩하여 목표 시간표를 교체함
2. '성공', '실패'과목 목록은 유지하되, '신청 전' 과목들이 새로운 목표에 따라 새롭게 추가됨.
3. 수강신청에는 성공했지만 새로운 목표 시간표에는 없는 과목의 경우, '성공'그룹에서 '취소 필요'경고가 뜨게 됨.
4. 최종적으로 목표 시간표에 맞게 '신청 성공' 과목들을 모두 모으면 성공임

### 4. 기술 아키텍처 요구사항

- **클라이언트 (Client)**

    - **기술 스택**: **Flutter**

    - **우선순위**: **웹(Web) 우선 개발**. 실제 수강신청 환경이 대부분 웹에서 이루어지기 때문.

- **백엔드 (Backend)**

    - **구조**: **마이크로서비스 아키텍처 (MSA)**

    - **API Gateway**

        - **역할**: Flutter 클라이언트를 위한 단일 진입점(Single Entry Point). 인증/인가, 로깅, 데이터 통합 등 공통 로직 처리.

        - **기술 스택**: **Spring Cloud Gateway** 사용.

        - **서비스명**: `api-gateway`

    - **개별 마이크로서비스**

        1. **강의 목록 서비스 (`catalog-service`)**

            - **역할**: 개설 강의 정보 관리. 주기적인 데이터 크롤링 및 업데이트, 다중 필터 검색 API 제공.

        2. **사용자 서비스 (`user-service`)**

            - **역할**: 사용자 계정 및 데이터 관리. 회원가입/로그인 등 인증 관리, 사용자가 생성한 시간표/플랜 데이터 등 사용자 소유의 정보 관리.

        3. **플래너 서비스 (`planner-service`)**

            - **역할**: 핵심 비즈니스 로직 처리. 사용자의 요청에 따라 의사결정 트리 구조의 시나리오 플랜을 생성, 수정, 저장하고, 실시간 네비게이터의 요청에 따라 트리 경로를 반환하는 로직 담당.

    - **서비스 간 통신 (Inter-Service Communication)**: **RESTful API**

    - DB: MySQL